<!DOCTYPE html>
{% load static %}
<html>
  <head>
        <link href="{% static 'css/sitestyle.css' %}" rel="stylesheet">
      <meta charset="utf-8">

{% block link %}
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

{% endblock %}

  <title>{% block title %}Знаток ПДД{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  </head>

  <body>
    <div id="navbar">
      {% block navbar %}
          <nav class="navbar">
            <ul class="nav">
              <li class="nav-item" style="border-left: 1px solid lightgrey;"><a class="nav-link text-uppercase text-center navitem" href="/" id="nav1">главная</a></li>
              <li class="nav-item"><a class="nav-link text-uppercase text-center navitem" id="nav2">автошколы</a></li>
              <li class="nav-item"><a class="nav-link text-uppercase text-center navitem" id="nav3">автоинструкторы</a></li>
              <li class="nav-item"><a class="nav-link text-uppercase text-center navitem" href="{% url 'our_team' %}" id="nav4">наша команда</a></li>
              <li class="nav-item"><a class="nav-link text-uppercase text-center navitem" id="nav5">каталог</a></li>
            </ul>
          </nav>
      {% endblock %}
    </div>

    <div id="panel">
      {% block panelheader %}
      <div class="panel-header">
        <div class="conteiner-fluid w1">
          <div class="row"  style="margin-right: 0px;">
            <div class="col-2 mr-auto ml-auto">
              <a href="/"><img src="{% static 'img/logo.gif' %}" class="logo"/></a>
            </div>
              <div class="col-5 ml-auto" id="game">
              {% block game %}
                  <ul class="list-unstyled">
                    <li class="gameresult js-game-ready" style="display: none;">
                      <div class="conteiner">
                        <div class="col-12 game__block-quest">
                          <div class="row">
                            <div class="col-10 ml-auto">
                              <div class="text-center mt-2 game__mini-question"><i id="mini-question"></i></div>
                            </div>
                            <div class="col-1 mr-auto game__skip-game">
                              <i class="fa fa-refresh" onclick="skipGame()" class="btn__skip-game" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <img src="" class="tic btn btn-default" id="0mini" />
                      <img src="" class="tic btn btn-default" id="1mini" />
                      <img src="" class="tic btn btn-default" id="2mini" />
                      <img src="" class="tic btn btn-default" id="3mini" />
                      <img src="" class="tic btn btn-default" id="4mini" />
                      <img src="" class="tic btn btn-default" id="5mini" />
                      <img src="" class="tic btn btn-default" id="6mini" />
                      <img src="" class="tic btn btn-default" id="7mini" />
                      <div class="col-12 text-right text-muted">Попыток осталось: <span class="text-dark" id="try-number"></span></div>
                      
                    </li>
                    <div class="col-6 ml-auto mr-auto game-not-ready text-center js-game-not-ready" style="display: none;">
                      <div class="text-primary">
                        <i>Следующие задания станут доступны через <strong id="js-timer"></strong></i>
                      </div>
                    </div>
                    <div class="alert alert-success js-alert-success" role="alert">
                      <i>Вы ответили правильно</i>
                    </div>
                    <div class="alert alert-danger js-alert-error" role="alert">
                      <i>Вы ответили не правильно</i>
                    </div>
            {% endblock %}
            </div>
             
            <div class="col-2 mr-auto ml-auto">
            {% block panela %}
            {% if user.is_authenticated %}
            <a class="btn-prof btn btn-primary" href="{% url 'profile' %}" style="font-size: 15px; margin-bottom: 3px; margin-top: 10%;">Мой профиль</a>
            <a href="{% url 'logout' %}" class="btn btn-prof btn-sec" style="font-size: 15px;">Выход</a>
                {% else %}
                {% block button %}
                  <button id="modalbtn" class="btn btn-prof btn-primary" style="font-size: 15px; margin-top: 10%;">ВХОД</button>
                  <a href="{% url 'signup' %}" class="btn btn-prof btn-sec" style="font-size: 15px;">Регистрация</a>
                {% endblock %}
              {% endif %}
            {% endblock %}
          </div>

          </div>
        </div>
        {% endblock %}
      </div>

      <div id="panel2">
        {% block panelbody %}
        <div class="panel-body" id="panelbody">
    <div class="conteiner">
        <div class="row">
          {% block coins %}
            <form class="form-inline col-12">
                <div class="form-group ml-auto">
                    <label for="bonus">БАЛЛЫ</label>
                    <div class="card card-body justify-content-center align-items-center" id="bonus" style="height: 35px; width: 80px">
                    </div>
                </div>

                <div class="form-group ml-auto">
                    <label for="team">КОМАНДНЫЕ</label>
                    <input type="team" class="form-control" id="team" readonly="123">
                </div>

                <div class="form-group ml-auto mr-auto">
                    <label for="coins">BEEPCOIN</label>
                    <input type="coins" class="form-control" id="coins" readonly="123">
                </div>
            </form>
            {% endblock %}
        </div>
    </div>
</div>
{% block coins1 %}
<div class="panel-body" id="panelbody1" style="display: none;">
    <div class="conteiner">
        <div class="row" >
            <form class="form-inline col-12">
                <div class="form-group ml-auto">
                    <label for="bonus1">БАЛЛЫ</label>
                    <div class="card card-body justify-content-center align-items-center" id="bonus1" style="height: 35px; width: 80px">
                    </div>
                </div>

                <div class="form-group ml-auto">
                    <label for="team">КОМАНДНЫЕ</label>
                    <input type="team" class="form-control" id="team" readonly="123">
                </div>

                <div class="form-group ml-auto mr-auto">
                    <label for="coins">BEEPCOIN</label>
                    <input type="coins" class="form-control" id="coins" readonly="123">
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
        {% endblock %}
      </div>
    </div>

  <div class="modal fade" id="modalLogin" role="dialog">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title text-center text-uppercase">вход на сайт</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <div class="modal-body">
          <div class="row" >
            <div class="col-lg-12">
                  <form method="post" novalidate>
                    {% csrf_token %}
                    {% include 'includes/form.html' %}
                    <small>
                      <a href="" class="text-muted">Забыли пароль?</a>
                    </small>
                    <button type="submit" class="btn btn-success pull-right" style="font-size: 15px;">ВОЙТИ</button>
                  </form>
                </div>
              </div>

          </div>

        <div class="modal-footer">
          VK, facebook, google+, mail, ya
        </div>
      </div>
    </div>
  </div>


<!-- Блок с экзаменом и тестами -->

  </div>
  <div id="maincontent">
    {% block main %}
    {% endblock %}

    {% block signup %}
    {% endblock %}

    {% block content %}
    {%  endblock %}

  <div id="panel-reno" style="margin-bottom: -20px;">
    {% block panelreno %}
    <div class="panel panel-default">
      <div class="conteiner">
        <div class="col-12">
          <div class="row back">
            <div class="col-1 ml-auto">
              <img src="https://vevents.ru/img/reno.png" class="logoreno" />
            </div>
            <div class="col-6">
              <div class="col-12 text">
                <p>Renault (Рено) - французская автомобильная компания, производит легковые, грузовые и спортивные автомобили. Совместно с румынской компанией Dacia выпускался недорогой и очень популярный Renault Logan.</p>
              </div>
              <div class="col-12 text-right">
                <a href="">Официальный диллер <strong>Renault</strong></a>
              </div>
            </div>
            <div class="col-2 mr-auto">
              <img src="https://www.auto-mgn.ru/resources/images/upload/00002752884458056b23.jpg" class="logan" />
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endblock %}
  </div>
  </div>
  
  <div id="online">
    {% block online %}
    {% endblock %}
  </div>

  <div id="panel-footer">
    <div class="panel-header">
      <div class="conteiner">
        <div class="row" style="margin-right: 15px;">
          <div class="col-8 mr-auto ml-auto">
            <div class="col-12">
              <p class="text-comment">Отзывы пользователей</p>
            </div>
            <div class="row align-items-center">
              <div class="col-2 text-center">
                <p id="js-rating0"></p>
                <i id="js-date0"></i>
              </div>
              <div class="col-2 text-center">
                <img src="" class="comment-avatar" id="js-avatar0">
              </div>
              <div class="col-8">
                <div class="row">
                  <div class="col-7 ml-auto" id="js-user0"></div>
                  <div class="col-3">
                    <p class="text-right" id="js-city0"></p>
                  </div>
                </div>
                  <div class="h-divider">
                  </div>
                  <div class="row">
                    <div class="col-8 ml-auto mr-auto usercomment">
                    <i id="js-text0"></i>
                  </div>
                  </div>
              </div>
            </div>
            <div class="row align-items-center">
              <div class="col-2 text-center">
                <p id="js-rating1"></p>
                <i id="js-date1"></i>
              </div>
              <div class="col-2 text-center">
                <img src="" class="comment-avatar" id="js-avatar1">
              </div>
              <i id="js-date1"></i>
              <div class="col-8">
                <div class="row">
                  <div class="col-7 ml-auto" id="js-user1"></div>
                  <div class="col-3">
                    <p class="text-right" id="js-city1"></p>
                  </div>
                </div>
                  <div class="h-divider">
                  </div>
                  <div class="row">
                    <div class="col-8 ml-auto mr-auto usercomment">
                    <i id="js-text1"></i>
                  </div>
                  </div>
              </div>
            </div>
            <div class="row align-items-center">
              <div class="col-2 text-center">
                <p id="js-rating2"></p>
                <i id="js-date2"></i>
              </div>
              <div class="col-2 text-center">
                <img src="" class="comment-avatar" id="js-avatar2">
              </div>
              <i id="js-date3"></i>
              <div class="col-8">
                <div class="row">
                  <div class="col-7 ml-auto" id="js-user2"></div>
                  <div class="col-3">
                    <p class="text-right" id="js-city2"></p>
                  </div>
                </div>
                  <div class="h-divider">
                  </div>
                  <div class="row">
                    <div class="col-8 ml-auto mr-auto usercomment">
                    <i id="js-text2"></i>
                  </div>
                  </div>
              </div>
            </div>
            <div class="col-12">
              <div class="row">
                <div class="col-2 mr-auto item-comment">
                  <span>Написать отзыв</span>
                </div>
                <div class="col-2 ml-auto item-comment">
                  <span>Еще отзывы</span>
                </div>
              </div>
            </div>
            <br>
            <br>
          </div>
        </div>
      </div>
    </div>
    <div class="panel-body gradient">
     <div class="conteiner">
      <div class="row">
       <div class="col-8 ml-auto mr-auto">
        <div class="row">
          <div class="col-6">
           <a href="#" class="btn text-uppercase" style="font-size: 15px;">
            о проекте
           </a>
          </div>
          <div class="col-6">
           <a href="#" class="btn text-uppercase" style="font-size: 15px;">
            сотруднечество
           </a>
          </div>
        </div>
        
       </div>
      </div>
      <div class="h-dividerw"></div>
      <div class="row">
       <div class="h-divider">
       </div>
      </div>
      <div class="row">
       <div class="col-8 mr-auto ml-auto">
        <div class="row">
        <div class="col-6">
         <ul class="list-unstyled text-uppercase">
          <li><a href="">миссия</a></li>
          <li><a href="">наша команда</a></li>
          <li><a href="">благодарности</a></li>
          <li><a href="">розыгрыши призов</a></li>
          <li><a href="">часто задаваемые вопросы</a></li>
          <li><a href="">вакансии</a></li>
          <li><a href="">контакты</a></li>
          <li><a href="">мы в соцсетях</a></li>
         </ul>
        </div>
        <div class="col-6">
         <ul class="list-unstyled text-uppercase">
          <li><a href="">вход для партнеров</a></li>
          <br>
          <li><a href="">автошколам</a></li>
          <li><a href="">автоинструкторам</a></li>
          <li><a href="">автодиллерам</a></li>
          <li><a href="">юридическим лицам</a></li>
          <li><a href="">реклама на сайте</a></li>
          <li><a href="">партнерская программа</a></li>
         </ul>
        </div>
       </div>
     </div>
      </div>
     </div>
    </div>
    <div class="panel-footer">
     <div class="conteiner">
       <div class="col-12 text-center">
        <ul class="list-inline">
         <li><strong>@ ZNATOK-PDD.RU 2017</strong></li>
         <li><strong>НКО "Безопасные дороги"</strong></li>
         <li style="color: rgb(92, 86, 81);">Все права защищены.</li>
        </ul>
       </div>
      </div>
     </div>
    </div>
  </div>
  </body>


  <script type="text/javascript" src="{% static '/js/jquery-3.2.1.min.js' %}"></script>
  <!-- <script src="http://code.jquery.com/jquery-latest.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    {% if form.errors %}
  <script>
    $(document).ready(function() {
        $("#modalLogin").modal();
    });
  </script>
  {% endif %}

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
  <script type="text/javascript" src="{% static '/js/jquery.cookie.js' %}"></script>

  <script>
//     *****************************************
//     СКРИПТ ДЛЯ МИНИ ИГРЫ
//     *****************************************
  let user_answer = ['0', '0', '0'];
  let counter = 0;

  function contentMiniGame(data) {
    $('.js-game-not-ready').hide();
    $('.js-game-ready').show();
    $(".tic").removeClass("act");
    document.getElementById('mini-question').textContent = data.pictures[8].question;
    $('#0mini').attr("src", "/media/" + data.pictures[0].url);
    $('#1mini').attr("src", "/media/" + data.pictures[1].url);
    $('#2mini').attr("src", "/media/" + data.pictures[2].url);
    $('#3mini').attr("src", "/media/" + data.pictures[3].url);
    $('#4mini').attr("src", "/media/" + data.pictures[4].url);
    $('#5mini').attr("src", "/media/" + data.pictures[5].url);
    $('#6mini').attr("src", "/media/" + data.pictures[6].url);
    $('#7mini').attr("src", "/media/" + data.pictures[7].url);
    document.getElementById('try-number').textContent = data.number_of_try - 2;
  }

  function skipGame() {
    $.ajax({

      type: "GET",

      url: "/skip_mini_game/",

      dataType: 'json',

      cache: false,

      success: function (data) {
        if (data.bool) {
          $.ajax({
            type: "GET",

            url: "/next_mini_game/",

            dataType: 'json',

            cache: false,

            success: function (data) {
              checkStageMiniGame();
            }
          });
        }
      }
    });
  }

  function playerAction(elem, id) {
    if ($(elem).hasClass("act")) {
      $(elem).removeClass("act");
      user_answer[counter] = '0';
      if (counter > 0) {
        counter -= 1;
      }
    } else if (counter < 3) {
      $(elem).addClass("act");
      user_answer[counter] = parseInt(id,10);
      counter += 1;
    }

    if (counter === 3) {
      $.ajax({

        type: "GET",

        url: "/check_answer_for_game/",

        data: { 'user_answer1': user_answer[0],
                'user_answer2': user_answer[1],
                'user_answer3': user_answer[2]},

        dataType: 'json',

        cache: false,

        success: function (data) {
          if (data.bool) {
            $('.js-alert-success').show();
            $.ajax({

              type: "GET",

              url: "/check_points/",

              dataType: 'json',

              cache: false,

              success: function (data) {
                document.getElementById('bonus').textContent = data.points;
                document.getElementById('bonus1').textContent = data.points;
              }
            });

            $.ajax({

              type: "GET",

              url: "/next_mini_game/",

              dataType: 'json',

              cache: false,

              success: function (data) {
                checkStageMiniGame();
              }
            });
          } else {
            $('.js-alert-error').show();
            $.ajax({

              type: "GET",

              url: "/reload_mini_game/",

              dataType: 'json',

              cache: false,

              success: function (data) {
                checkStageMiniGame();
              }
            });
          }
        }
      });
    }
  }

  $(".tic").click(function(){
    let id = $(this).attr("id");
    let e = document.getElementById(id);
    playerAction(e,id);
  });

  function miniGameNotReady(time) {
    let constTime;
    $('.js-game-ready').hide();
    $('.js-game-not-ready').show();

    if (time === 'starttimer') {
      constTime = '29:59';
    } else {
      constTime = time.match(/\d*M\d*/g).toString().replace('M', ':');
    }

    function startTimer(timer) {
      if (timer !== undefined) {
        document.getElementById('js-timer').innerText = timer;
      }
      const elem = document.getElementById('js-timer');
      let tim = elem.innerText;
      let min = tim[0] + tim[1];
      let seconds = tim[3] + tim[4];
      if (seconds === '00') {
        if (min === '00') {
          $('.js-game-not-ready').hide();
        }
        min -= 1;
        seconds = '59';
        if (min < '10') min = '0' + min;
      } else {
        seconds -= 1;
      }
      if (seconds < 10) {
        seconds = '0' + seconds;
      }
      elem.textContent = min + ':' + seconds;
      setTimeout(startTimer, 1000);
    }
    startTimer(constTime);
  }

  function loadMiniGame() {
    $.ajax({

      type: "GET",

      url: "/load_picture/",

      dataType: 'json',

      cache: false,

      success: function (data) {
        contentMiniGame(data);
      }
    });
  }

  function checkStageMiniGame() {
    counter = 0;
    $.ajax({
      type: "GET",
      url: "/check_game_is_ready/",
      cache: false,
      success: function(data){
        if (data.mini_game_is_ready === 1) {
          loadMiniGame();
        } else if (data.timer !== null) {
          miniGameNotReady(data.timer);
        } else {
          miniGameNotReady('starttimer');
        }
      }
    });
  }

//     *****************************************




//     *****************************************
//     СКРИПТ ДЛЯ КОММЕНТАРИЕВ
//     *****************************************
    function commentsData(objects) {
      for (let i = 0; i < objects.comments.length; i++) {
        document.getElementById("js-user" + i).innerText = objects.comments[i].user;
        document.getElementById("js-text" + i).innerText = objects.comments[i].text;
        document.getElementById("js-date" + i).innerText = objects.comments[i].date.match(/\d*-\d*-\d*/g);
        document.getElementById("js-city" + i).innerText = objects.comments[i].city;
        document.getElementById("js-rating" + i).innerText = objects.comments[i].rating;
        const element = document.getElementById('js-avatar' + i);
        $(element).attr("src", objects.comments[i].avatar);
      }
    }
    
    function loadComments() {
      $.ajax({
        type: "GET",
        url: "/get_comments/",
        cache: false,
        success: function(data){
          commentsData(data);
        }
      });
    }
//     *****************************************
    $(document).ready(function() {
      loadComments();
      checkStageMiniGame();
    });

  </script>

  <script>
    var counter_for_theory = 0;
    jQuery(document).ready(function($) {
  var
    $window = $(window),
    $target = $("#panelbody"),
    $h = $target.offset().top;
  $window.on('scroll', function() {
    var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    if (scrollTop > $h) {
      $("#panelbody1").addClass("show_block");
    } else {
      $("#panelbody1").removeClass("show_block");
    }
  });
 });
  $(".navitem").click(function(){
    var id = $(this).attr("id");
    var e = document.getElementById(id);
    $(".navitem").removeClass("active");
    $(e).addClass("active");
  });

  $(".navitem1").click(function(){
    var id = $(this).attr("id");
    var e = document.getElementById(id);
    $(".navitem1").removeClass("active");
    $(e).addClass("active");

    if ((id === "block1") && (counter_for_theory === 0)) {
      counter_for_theory++;
      $(".btnquest").addClass("hide");
      $(".top5").addClass("hide");
      $(".top6").removeClass("hide");
      $(".b1").addClass("hide");
      $(".b2").removeClass("hide");
    } else if((id === "block1") && (counter_for_theory === 1)) {
      $(".btnquest").removeClass("hide");
      $(".top5").removeClass("hide");
      $(".top6").addClass("hide");
      $(".b1").removeClass("hide");
      $(".b2").addClass("hide");
      counter_for_theory = 0;
      $("#block2").addClass("active");
      $("#block1").removeClass("active");
    }

    if (id === "block1_team") {
      $(".img_team").addClass("hide");
      $("#activity").removeClass("hide");
    } else if (id === "block2_team") {
      $(".img_team").addClass("hide");
      $("#volunteers").removeClass("hide");
    } else if (id === "block3_team") {
      $(".img_team").addClass("hide");
      $("#business").removeClass("hide");
    } else if (id === "block4_team") {
      $(".img_team").addClass("hide");
      $("#investors").removeClass("hide");
    } else if (id === "block5_team") {
      $(".img_team").addClass("hide");
      $("#developers").removeClass("hide");
    } else if (id === "block6_team") {
      $(".img_team").addClass("hide");
      $("#agencies").removeClass("hide");
    }
  });

  $(document).ready(function(){
    $.ajax({

        type: "GET",

        url: "/check_points/",

        cache: false,

        success: function (data) {
          document.getElementById('bonus').textContent = data.points;
          document.getElementById('bonus1').textContent = data.points;
        }
    });

    $("#cat1").addClass("active");
    $("#block2").addClass("active");

    var l1 = document.getElementById("lamb1");
    var l2 = document.getElementById("lamb2");
    var l3 = document.getElementById("lamb3");
    var select = 0;
    
    $(".confirm").addClass("disabled");

    $(".lamb").click(function(){
      var id = $(this).attr("id");
      var e = document.getElementById(id);
      userAction(e, id, l1, l2, l3);
  });

    function userAction(elem, id, l1, l2, l3) {
      if ($(elem).hasClass("lambact")) {
        $(elem).removeClass("lambact");
        select = 0;
        $(".confirm").addClass("disabled");
      } else {
        if ((elem != l1) && (elem != l2)) {
          $(elem).addClass("lambact");
          $(l1).removeClass("lambact");
          $(l2).removeClass("lambact");
          $(".confirm").removeClass("disabled");
          select = 3;
        } else if ((elem != l1) && (elem != l3)) {
          $(elem).addClass("lambact");
          $(l1).removeClass("lambact");
          $(l3).removeClass("lambact");
          $(".confirm").removeClass("disabled");
          select = 2;
        } else if ((elem != l2) && (elem != l3)) {
          $(elem).addClass("lambact");
          $(l2).removeClass("lambact");
          $(l3).removeClass("lambact");
          $(".confirm").removeClass("disabled");
          select = 1;
        } else {
          select = 0;
        }
      }

      $(".confirm").click(function(){
        confirmSelection(select);
    });
    }

    function confirmSelection(select) {

    }
});


  $(document).ready(function() {
      $("#modalbtn").click(function () {
          $("#modalLogin").modal();
      });
  });

</script>
  {% block javascript %}


  {% endblock %}

</html>