{% extends "base.html" %}
{% load static %}

{% block main %}
  <div class="conteiner text-center">
    <div class="row" style="margin-right: auto;">
      <div class="col-2 ml-auto text-uppercase">
        <div class="row">
          <ul class="navleft nav flex-column">
            <li class="nav-item2 ml-auto">
              <a class="nav-link navitem1" id="block1">Теория</a>
            </li>
            <li class="nav-item2 ml-auto top b1">
              <a class="nav-link navitem1 active" id="block2">Билеты</a>
            </li>
            <li class="nav-item2 ml-auto top b1">
              {% if user.is_authenticated %}
              <a class="nav-link navitem1" id="block3"  data-toggle="popover" data-trigger="focus" data-content="Возможно скоро будет готово">Экзамен</a>
              {% else %}
              <a class="nav-link navitem1" id="block3"  data-toggle="popover" data-trigger="focus" data-content="Вам необходимо зарегистрироваться">Экзамен</a>
              {% endif %}
            </li>
            <li class="nav-item2 ml-auto top b1">
              <a class="nav-link navitem1" id="block4">по темам</a>
            </li>
            <li class="nav-item2 ml-auto top b1">
              <a class="nav-link navitem1" id="block5" data-toggle="popover" data-trigger="focus" data-content="Вам необходимо зарегистрироваться">марафон</a>
            </li>
            <li class="nav-item2 ml-auto top b1">
              <a class="nav-link navitem1" id="block6" data-toggle="popover" data-trigger="focus" data-content="Вам необходимо зарегистрироваться">ошибки</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1 active" id="block7">Правила дорожного движения</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1" id="block8">Дорожные знаки</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1" id="block9">Дорожная разметка и её характеристики</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1" id="block10">основные положения по допуску транспортных средств к эксплуатации и обязанности должностных лиц по обеспечению безопасности дорожного движения</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1" id="block11">перечень неисправностей и условий, при которых запрещается эксплуатация транспортных средств</a>
            </li>
            <li class="nav-item2 ml-auto top b2 hide">
              <a class="nav-link navitem1" id="block12">перечень штрафных санкций в соответствии с коап <br>глава 12. Административные правонарушения в области дорожного движения</a>
            </li>
            <br>
          </ul>
        </div>
      </div>
      <div class="col-6 text-uppercase">
        <div class="row">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" id="cat1">Категории <strong>A, B, M</strong></a>
            </li>
            <li class="nav-item ml-auto">
              <a class="nav-link" id="cat2">Категории <strong>C, D</strong></a>
            </li>
          </ul>
        </div>
        <div class="row" style="margin-left: 5px;">
            <div class="col-12 bordering text-center blockmain">

            </div>
        </div>
      </div>
      <div class="col-2 mr-auto" id="leadres">
        <div class="row">
          <div class="col-10 mr-auto ml-auto">
            <table class="leaders-table">
              <tr class="leader-header">
                <td colspan="3" class="text-uppercase text-primary text-center h4">
                  Лидеры недели
                </td>
              </tr>
              <tr class="leader-table">
                <td rowspan="2">
                  <img src="" class="js-leader-avatar0 leader-avatar" />
                </td>
                <td class="h5 leader-text">
                  <p id="js-leader-name0"></p>
                  <small id="js-leader-city0"></small>
                </td>
                <td>
                  <img src="{% static 'img/gold.png' %}" class="gold" />
                </td>
              </tr>
              <tr>
                <td class="text-right leader-coins text-primary text-uppercase">
                  Баллы
                </td>
                <td class="leader-coins">
                  <span class="leader-coins-counter" id="js-leader-coins0"></span>
                </td>
              </tr>

              <tr class="leader-table">
                <td rowspan="2">
                  <img src="" class="js-leader-avatar1 leader-avatar" />
                </td>
                <td class="h5 leader-text">
                  <p id="js-leader-name1"></p>
                  <small id="js-leader-city1"></small>
                </td>
                <td>
                  <img src="{% static 'img/silver.png' %}" class="gold" />
                </td>
              </tr>
              <tr>
                <td class="text-right leader-coins text-primary text-uppercase">
                  Баллы
                </td>
                <td class="leader-coins">
                  <span class="leader-coins-counter" id="js-leader-coins1"></span>
                </td>
              </tr>

              <tr class="leader-table">
                <td rowspan="2">
                  <img src="" class="js-leader-avatar2 leader-avatar" />
                </td>
                <td class="h5 leader-text">
                  <p id="js-leader-name2"></p>
                  <small id="js-leader-city2"></small>
                </td>
                <td>
                  <img src="{% static 'img/bronze.png' %}" class="gold" />
                </td>
              </tr>
              <tr>
                <td class="text-right leader-coins text-primary text-uppercase">
                  Баллы
                </td>
                <td class="leader-coins">
                  <span class="leader-coins-counter" id="js-leader-coins2"></span>
                </td>
              </tr>

            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block online %}
  <div id="online" class="background2">
    <div id="onlinecontent" class="conteiner onlinecontent">
      <div class="col-6 mr-auto ml-auto text-center text-uppercase titletext">
        <p>Примите участие в ON-LINE состязаниях с другими пользователями сайта	</p>
      </div>



<!-- Блок онлайн игры -->
      {% include "online_game/online_game_place.html" %}
    </div>


    <div id="panellamb">
      <div class="col-10 mr-auto ml-auto text-center text-uppercase titletext">
        <p>присоединяйтесь к командной гонке за баллами</p>
      </div>
      <div class="panel panel-default">
        <div class="conteiner-fluid">
          <div class="row1 row">
            <div class="col-8  ml-auto mr-auto">
              <div class="dropdown">
                <button class="btn btn-black dropdown-toggle text-right" type="button" id="drop_for_team_info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%;">
                </button>
                <div class="dropdown-menu text-center" aria-labelledby="drop_for_team_info" style="width: 100%;">
                  asd
                </div>
              </div>
              <div class="row btnrow">
                <div class="col-3">
                  <img src="{% static 'img/greenlamb.png' %}" class="lamb" id="lamb1" />
                </div>
                <div class="col-3">
                  <img src="{% static 'img/yellowlamb.png' %}" class="lamb" id="lamb2" />
                </div>
                <div class="col-3">
                  <img src="{% static 'img/redlamb.png' %}" class="lamb" id="lamb3" />
                </div>
                <div class="col-3 text-center">
                  <a class="btn btn-secondary text-uppercase confirm">Выбрать команду</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<template id="templateQuestionList" style="display: none">
  <div class="wrongblock js-question-block col-12">
    <div class="row blockwrong">
      <div class="col-6">
      <div class="row">
        <img src=" " class="wrong-question-img js-question-img">
      </div>
    </div>
    <div class="col-6 mt-auto mb-auto">
      <p class="text-primary"><i class="wrong-question-text js-question-text"></i></p>
    </div>
    </div>
    <div class="borderbtn">
    </div>
  </div>
</template>

<template id="templateMarathon" style="display: none;">
  <div class="col-12 marathon">
    <div class="dropdown">
      <button class="btn btn-default dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%; border: 1px solid lightgrey;">
      </button>
      <div class="dropdown-menu text-center" aria-labelledby="drop_for_ticket_info" style="width: 100%;">Марафон
      </div>
    </div>
    <div class="boxing top5 d-flex justify-content-between">
      <p class="text-uppercase">Пройдено вопросов <span class="text-primary font-weight-bold js-marathon-count-questions h3">-</span><span class="h3 font-weight-bold"> / 800</span></p>
      <p>Ошибок <span class="text-danger font-weight-bold js-marathon-wrong h3">-</span> <span class="h3">/</span> <span class="text-primary font-weight-bold js-marathon-count-questions h3">-</span></p>
      <p>Знаний <span class="text-danger font-weight-bold js-marathon-knowledge h3">-</span></p>
    </div>
    <div class="boxing d-flex justify-content-between">
      <p class="text-uppercase">Время прохождения <span class="text-primary font-weight-bold js-marathon-time h3">-</p>
      <p>В среднем на один вопрос <span class="text-danger font-weight-bold js-marathon-time-average h3">-</span></p>
    </div>
    <div class="container marathon">
      <div class="row d-flex justify-content-center">
        <div class= "alert alert-primary h1 mr-auto" data-id="1">
          50<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="2">
          60<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="3">
          70<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="4">
          80<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="5">
          90<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="6">
          100<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="7">
          110<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto" data-id="8">
          120<br><span class="h5">баллов</span>
        </div>
      </div>
      <!-- alert-primary text-muted -->
      <div class="row d-flex justify-content-center">
        <div class="alert alert-primary h1 mr-auto" data-id="9">
          130<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="10">
          140<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="11">
          150<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="12">
          160<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="13">
          170<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="14">
          180<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto mr-auto" data-id="15">
          190<br><span class="h5">баллов</span>
        </div>
        <div class="alert alert-primary h1 ml-auto" data-id="16">
          200<br><span class="h5">баллов</span>
        </div>
      </div>
      <div class="row">
        <div class="col-5 mr-auto ml-auto">
          <div class="btn btn-success text-uppercase">
            Начать марафон
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<template id="countButton" style="display: none;">
  <button class="custombtn" data-id=""></button>
</template>

<template id="blockTheme" style="display: none;">
  <div class="themese">
    <div class="col-12">
      <div class="dropdown">
        <button class="btn btn-default dropdown-toggle text-right" type="button" id="drop_for_ticket_info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%; border: 1px solid lightgrey;">
        </button>
        <div class="dropdown-menu text-center" aria-labelledby="drop_for_ticket_info" style="width: 100%;">
          Отвечая на вопросы по темам на результат в 100%, в личном кабинете (блок Достижения) появятся похвальные грамоты по пройденым темам. Так же, в процессе прохождения, Вам будут начислятся баллы за верные ответы
        </div>
      </div>
    </div>
    <div class="themebtn1 col-12">
      <div class="button-list js-btn-list"></div>
      <div class="js-question"></div>
    </div>
  </div>
</template>

<template id="templateBtnForQuestion">
  <button class="button-list__button btn btn-default js-btnquest">1</button>
</template>

<template id="themeBtnTemplate">
  <div class="themebtncontent">
    <div class="theme text-left">
      <span class="theme-text">Дорожные знаки</span>
    </div>
    <div class="theme-gradient"></div>
  </div>
</template>

<template id="templateQuestion" style="display: none">
  <div class="row boxing top6 hide"> 
    билеты по теории 
  </div>
  <div id="result" class="result js-result row boxing top5">
  <div class="conteiner" style="width: 100%;"> 
    <div class="row boxing"> 
      <div class="col-12"> 
      <div class="col-12 text-left objquestion"> 
        <p id="quest" class="js-question"></p> 
      </div> 
      <div class="row"> 
        <img class="imgquestion js-img-question" /> 
      </div> 
    </div> 
  </div> 
  <div class=""> 
    <ul class="list-unstyled" style="padding-top: 0.5em;"> 
      <li> 
        <div class="answbtn text-left btn btn-default" id="answer1"></div> 
      </li> 
      <li> 
        <div class="answbtn text-left btn btn-default" id="answer2"></div> 
      </li> 
      <li> 
        <div class="answbtn text-left btn btn-default" id="answer3"></div> 
      </li> 
      <li> <div class="answbtn text-left btn btn-default" id="answer4"></div>
       </li>
        <li> 
          <div class="answbtn text-left btn btn-default" id="answer5"></div> 
        </li> 
      </ul> 
    </div> 
    <div class="conteiner help-box" style="display: none;"> 
      <div class="row"> 
        <div class="col-12 text-left"> 
          <ul class="list-inline"> 
            <li>
              <button class="helpbtn btn btn-default">ПОЯСНЕНИЕ</button>
            </li> 
            <li>
              <button class="penaltybtn btn btn-default">ШТРАФЫ</button>
            </li> 
            <li>
              <button class="nextbtn btn btn-success">Далее</button>
            </li> 
          </ul> 
        </div> 
      </div> 
      <ul class="list-inline" id="help-text">
      </ul> 
    </div> 
  </div> 
</div>
</template>

<template id="listQuestionsTemplate">
  <div>

  </div>
</template>
{% endblock %}

{% block javascript %}
<script type="text/javascript" src="{% static '/js/jquery-3.2.1.min.js' %}"></script>
  <script type="text/javascript" src="{% static '/js/onlineGame.js' %}"></script>
  <script src="{% static "channels/js/websocketbridge.js" %}" type="text/javascript"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="{% static '/js/home.js' %}"></script>
  <script>
      var category = 0;
      var number_of_ticket = 0;
      var number_of_question = 1;
      var res = [];
      let initTickets = true;
      let initTicketsInside = false;
      let intitThemes = false;
      let initWrong = false;
      let initMarathon = false;
      let counterWrongQuestion = 0;
      let initBool = true;
      let initWrongQuestionReload = false;

      function clearInits() {
        initWrong = false;
        initTickets = false;
        intitThemes = false;
        initTicketsInside = false;
        initMarathon = false;
        initBool = true;
        initWrongQuestionReload = false;
      }

      function singleQuestionTemplate(data) {
        const templateContainerSingleQuestion = document.getElementById('templateQuestion');
        const templateContainerQuestion = 'content' in templateContainerSingleQuestion ? templateContainerSingleQuestion.content : templateContainerSingleQuestion;
        const newElementQuestion = templateContainerQuestion.getElementById('result').cloneNode(true);

        if (!data.picture) {
          const i = document.createElement('i');
          $(i).addClass('fa fa-refresh js-wrong-question-refresh wrong-question-refresh fa-lg');
          i.setAttribute('aria-hidden', 'true');
          newElementQuestion.querySelector('.objquestion').appendChild(i);
        }

        newElementQuestion.querySelector('.js-question').textContent = data.question__question || data.question;
        newElementQuestion.querySelector('.js-img-question').src = '/media/' + (data.question__picture ? data.question__picture : data.picture);
        newElementQuestion.querySelector('#answer1').textContent = data.question__answer1 || data.answer1;
        newElementQuestion.querySelector('#answer2').textContent = data.question__answer2 || data.answer2;
        newElementQuestion.querySelector('#answer3').textContent = data.question__answer3 || data.answer3;

        if (data.question__answer4 || data.answer4) {
          newElementQuestion.querySelector('#answer4').textContent = data.question__answer4 || data.answer4;
        } else {
          $(newElementQuestion.querySelector('#answer4')).hide();
        }

        if (data.question__answer5 || data.answer5) {
          newElementQuestion.querySelector('#answer5').textContent = data.question__answer5 || data.answer5;
        } else {
          $(newElementQuestion.querySelector('#answer5')).hide();
        }

        newElementQuestion.querySelector('.help-box').style.display = 'block';


        if (!data.picture) {
          newElementQuestion.querySelector('#help-text').textContent = data.question__comment_for_question || data.comment_for_question;

          for(let i = 1; i < 6; i++) {
          const item = newElementQuestion.querySelector('#answer' + i);

          if (!item) {
            return;
          }

          $(item).addClass('disabled');

          if (item.textContent === data.user_answer) {
            $(item).addClass('btn-danger');
          }
        }
        }

        return newElementQuestion;
      }

      function getWrongQuestions(category, counterWrong) {

        $.ajax({

          type: "GET",

          url: "get_wrong_questions/",

          data: {
              'category': category,
              'counter': counterWrong,
              'next': false,
              'value_next': 0
          },

          cache: false,

          success: function (data) {
            loadWrongQuestions(data);
          }
        });
      }

      function getElementByClassAndtextContent(className, text) {
          var elements = document.getElementsByClassName(className);
          for (var i = 0; i < elements.length; i++) {
              if (elements[i].textContent === text)
                  return elements[i];
          }
      }

      function changeData(data) {

          $(".answbtn").removeClass("btn-success btn-danger");
          document.getElementById('quest').textContent = data.questions[0].question;
          $('.imgquestion').attr("src", "/media/" + data.questions[0].picture);
          document.getElementById('help-text').textContent = data.questions[0].comment_for_question;
          document.getElementById('answer1').textContent = data.answers[0];
          document.getElementById('answer2').textContent = data.answers[1];
          if (data.answers[2]) {
              document.getElementById('answer3').textContent = data.answers[2];
              $('#answer3').show();
          }
          else $('#answer3').hide();
          if (data.answers[3]) {
              document.getElementById('answer4').textContent = data.answers[3];
              $('#answer4').show();
          }
          else $('#answer4').hide();
          if (data.answers[4]) {
              document.getElementById('answer5').textContent = data.answers[4];
              $('#answer5').show();
          }
          else $('#answer5').hide();


          if (res[number_of_question - 1].user_answer) {
              var t_answ = getElementByClassAndtextContent("answbtn", res[number_of_question - 1].true_answer);
              $(t_answ).addClass('btn-success');
              if (res[number_of_question - 1].true_answer !== res[number_of_question -1].user_answer) {
                  var u_answ = getElementByClassAndtextContent("answbtn", res[number_of_question - 1].user_answer);
                  $(u_answ).addClass('btn-danger');
              }
              $('.answbtn').addClass('disabled');
              $('.help-box').show();
          } else {
              $('.answbtn').removeClass('disabled');
              $('.help-box').hide();
          }


          for (var i = 0; i <= 19; i++) {
              var btnquest = document.getElementById("btnquest" + (i + 1));
              $(btnquest).removeClass('btn-danger btn-success btn-primary disabled');
              if (i + 1 === number_of_question) {
                  $(btnquest).addClass('btn-primary disabled');
              } else if (res[i].user_answer) {
                  if (res[i].user_answer === res[i].true_answer) {
                      $(btnquest).addClass('btn-success');
                  } else $(btnquest).addClass('btn-danger');
              }
          }
      }

      function initBtnForTickets() {
        $('.btnticket').click(event => {
          number_of_ticket = event.currentTarget.value;
          number_of_question = 1;
          $.ajax({

              type: "GET",

              url: "load_ticket/",

              data: {
                  'number_of_ticket': number_of_ticket,
                  'category': category
              },

              cache: false,

              success: function (data) {
                initTicketsInside = true;
                $('.btnticket').hide();
                $('.result').show();
                $('.btnquest-box1').show();
                number_of_question = data.questions[0].number_of_question
                res = data.results;
                changeData(data);
              }
          });
        });

        // загрузка вопроса 
        $(".btnquest").click(function () {
          console.log('asdadssadsad');
            number_of_question = Number($(this).attr("value"));
            loadQuestion();
        });

        $(".nextbtn").click(function () {
            if (number_of_question === 20) {
                if (number_of_ticket != 40) {
                    number_of_question = 1;
                    number_of_ticket++;

                    $.ajax({

                        type: "GET",

                        url: "load_ticket/",

                        data: {
                            'number_of_ticket': number_of_ticket,
                            'category': category
                        },

                        cache: false,

                        success: function (data) {
                            $('.btnticket').hide();
                            $('.result').show();
                            $('.btnquest-box1').show();

                            number_of_question = data.questions[0].number_of_question
                            res = data.results;
                            changeData(data);
                        }
                    });
                }
            } else {
                number_of_question++;
                loadQuestion();
            }
        });

        function checkAnsw(answbtn, theme=false) {
            var user_answ = answbtn.textContent || answbtn.innerText;
            $.ajax({

                type: "GET",

                url: "check_answer/",

                data: {
                    'number_of_ticket': number_of_ticket,
                    'number_of_question': number_of_question,
                    'category': category,
                    'answer_by_user': user_answ,
                    'theme': theme,
                    'wrong': false
                },
                dataType: 'json',

                cache: false,

                success: function (data) {
                    $('.help-box').show();

                    $.ajax({

                        type: "GET",

                        url: "check_points/",

                        cache: false,

                        success: function (data) {
                            document.getElementById('bonus').textContent = data.points;
                        }
                    });

                    if (user_answ === data.true_answer) {
                        $(answbtn).addClass("btn-success");
                    } else {
                        $(answbtn).addClass("btn-danger");
                        var true_answbtn = getElementByClassAndtextContent("answbtn", data.true_answer);
                        $(true_answbtn).addClass("btn-success");
                    }
                    $('.answbtn').addClass("disabled");
                    res[number_of_question - 1].user_answer = user_answ;
                    res[number_of_question - 1].true_answer = data.true_answer;

                    if (number_of_ticket == 40) {
                        $(".nextbtn").addClass('disabled')
                    }

                }
            });
        }

        function loadQuestion() {
            $.ajax({

                type: "GET",

                url: "load_question/",

                data: {
                    'number_of_ticket': number_of_ticket,
                    'number_of_question': number_of_question,
                    'category': category
                },

                cache: false,

                success: function (data) {
                    changeData(data);
                }
            });
        }

        function isHide(elem) {
            return (elem.style.display === 'none');
        }

        $("body").keydown(function(event) {
          if (!initTicketsInside) {
            return;
          }
            if (!res[number_of_question - 1].user_answer) {
                let elem;
                switch (event.which) {
                    // 1
                    case 49:
                        checkAnsw(document.getElementById("answer1"));
                        break;
                    // 2
                    case 50:
                        checkAnsw(document.getElementById("answer2"));
                        break;
                    // 3
                    case 51:
                        checkAnsw(document.getElementById("answer3"));
                        break;
                    // 4
                    case 52:
                        elem = document.getElementById("answer4");
                        if (!(isHide(elem))) {
                            checkAnsw(elem);
                        }
                        break;
                    // 5
                    case 53:
                        elem = document.getElementById("answer5");
                        if (!(isHide(elem))) {
                            checkAnsw(elem);
                        }
                        break;
                    default:
                        break;
                }
            }

            switch (event.which) {
                // left arrow
                case 37:
                    if (number_of_question > 1) {
                        number_of_question--;
                        loadQuestion();
                    }
                    break;
                // right arrow
                case 39:
                    if (number_of_question < 20) {
                        number_of_question++;
                        loadQuestion();
                    }
                    break;

            }
        });

        $(".answbtn").click(function () {
            var answbtn_id = $(this).attr("id");
            var answbtn = document.getElementById(answbtn_id);
            checkAnsw(answbtn);
        });
      }

      function loadTickets() {
        document.querySelector(".blockmain").innerHTML = '';
        document.querySelector(".blockmain").innerHTML = '<div class="col-12"> <div class="dropdown"> <button class="btn btn-default dropdown-toggle text-right" type="button" id="drop_for_ticket_info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%; border: 1px solid lightgrey;"> </button> <div class="dropdown-menu text-center" aria-labelledby="drop_for_ticket_info" style="width: 100%;"> asdasd </div> </div> </div> <div class="row boxing top5"> <button class="btnticket ml-auto" id="btnticket1" type="button" value="1">1 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success1" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger1" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary1" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket2" type="button" value="2">2 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success2"> </div> <div class="progress-bar bg-danger" id="danger2"> </div> <div class="progress-bar bg-white" id="secondary2"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket3" type="button" value="3">3 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success3" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger3" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary3" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket4" type="button" value="4">4 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success4" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger4" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary4" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket5" type="button" value="5">5 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success5" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger5" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary5" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket6" type="button" value="6">6 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success6" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger6" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary6" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket7" type="button" value="7">7 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success7" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger7" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary7" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto mr-auto" id="btnticket8" type="button" value="8">8 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success8" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger8" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary8" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> </div> <div class="row boxing top5"> <button class="btnticket ml-auto" id="btnticket9" type="button" value="9">9 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success9" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger9" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary9" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket10" type="button" value="10">10 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success10" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger10" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary10" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket11" type="button" value="11">11 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success11" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger11" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary11" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket12" type="button" value="12">12 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success12" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger12" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary12" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket13" type="button" value="13">13 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success13" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger13" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary13" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket14" type="button" value="14">14 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success14" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger14" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary14" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket15" type="button" value="15">15 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success15" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger15" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary15" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto mr-auto" id="btnticket16" type="button" value="16">16 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success16" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger16" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary16" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> </div> <div class="row boxing top5"> <button class="btnticket ml-auto" id="btnticket17" type="button" value="17">17 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success17" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger17" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary17" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket18" type="button" value="18">18 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success18" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger18" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary18" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket19" type="button" value="19">19 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success19" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger19" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary19" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket20" type="button" value="20">20 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success20" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger20" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary20" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket21" type="button" value="21">21 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success21" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger21" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary21" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket22" type="button" value="22">22 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success22" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger22" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary22" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket23" type="button" value="23">23 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success23" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger23" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary23" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto mr-auto" id="btnticket24" type="button" value="24">24 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success24" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger24" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary24" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> </div> <div class="row boxing top5"> <button class="btnticket ml-auto" id="btnticket25" type="button" value="25">25 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success25" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger25" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary25" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket26" type="button" value="26">26 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success26" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger26" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary26" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket27" type="button" value="27">27 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success27" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger27" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary27" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket28" type="button" value="28">28 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success28" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger28" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary28" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket29" type="button" value="29">29 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success29" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger29" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary29" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket30" type="button" value="30">30 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success30" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger30" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary30" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket31" type="button" value="31">31 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success31" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger31" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary31" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto mr-auto" id="btnticket32" type="button" value="32">32 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success32" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger32" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary32" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> </div> <div class="row boxing top5"> <button class="btnticket ml-auto" id="btnticket33" type="button" value="33">33 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success33" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger33" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary33" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket34" type="button" value="34">34 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success34" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger34" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary34" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket35" type="button" value="35">35 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success35" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger35" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary35" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket36" type="button" value="36">36 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success36" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger36" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary36" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket37" type="button" value="37">37 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success37" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger37" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary37" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket38" type="button" value="38">38 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success38" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger38" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary38" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto" id="btnticket39" type="button" value="39">39 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success39" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger39" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary39" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> <button class="btnticket ml-auto mr-auto" id="btnticket40" type="button" value="40">40 <div class="progress" style="display: none;"> <div class="progress-bar bg-success" id="success40" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-danger" id="danger40" aria-valuemin="0" aria-valuemax="100"> </div> <div class="progress-bar bg-white" id="secondary40" aria-valuemin="0" aria-valuemax="100"> </div> </div> </button> </div> <div class="row boxing btnquest-box1" style="display:none"> <button class="btnquest btn btn-default ml-auto" id="btnquest1" value="1">1</button> <button class="btnquest btn btn-default ml-auto" id="btnquest2" type="button" value="2">2</button> <button class="btnquest btn btn-default ml-auto" id="btnquest3" type="button" value="3">3</button> <button class="btnquest btn btn-default ml-auto" id="btnquest4" type="button" value="4">4</button> <button class="btnquest btn btn-default ml-auto" id="btnquest5" type="button" value="5">5</button> <button class="btnquest btn btn-default ml-auto" id="btnquest6" value="6">6</button> <button class="btnquest btn btn-default ml-auto" id="btnquest7" type="button" value="7">7</button> <button class="btnquest btn btn-default ml-auto" id="btnquest8" type="button" value="8">8</button> <button class="btnquest btn btn-default ml-auto" id="btnquest9" type="button" value="9">9</button> <button class="btnquest btn btn-default ml-auto" id="btnquest10" type="button" value="10">10</button> <button class="btnquest btn btn-default ml-auto" id="btnquest11" type="button" value="11">11</button> <button class="btnquest btn btn-default ml-auto" id="btnquest12" type="button" value="12">12</button> <button class="btnquest btn btn-default ml-auto" id="btnquest13" type="button" value="13">13</button> <button class="btnquest btn btn-default ml-auto" id="btnquest14" type="button" value="14">14</button> <button class="btnquest btn btn-default ml-auto" id="btnquest15" type="button" value="15">15</button> <button class="btnquest btn btn-default ml-auto" id="btnquest16" type="button" value="16">16</button> <button class="btnquest btn btn-default ml-auto" id="btnquest17" type="button" value="17">17</button> <button class="btnquest btn btn-default ml-auto" id="btnquest18" type="button" value="18">18</button> <button class="btnquest btn btn-default ml-auto" id="btnquest19" type="button" value="19">19</button> <button class="btnquest btn btn-default ml-auto mr-auto" id="btnquest20" type="button" value="20">20</button> </div> <div class="row boxing top6 hide"> билеты по теории </div> <div id="result" class="result row boxing top5" style="display: none"> <div class="conteiner" style="width: 100%;"> <div class="row boxing"> <div class="col-12"> <div class="col-12 text-left objquestion"> <p id="quest"></p> </div> <div class="row"> <img class="imgquestion" /> </div> </div> </div> <div class=""> <ul class="list-unstyled" style="padding-top: 0.5em;"> <li> <div class="answbtn text-left btn btn-default" id="answer1"></div> </li> <li> <div class="answbtn text-left btn btn-default" id="answer2"></div> </li> <li> <div class="answbtn text-left btn btn-default" id="answer3"></div> </li> <li> <div class="answbtn text-left btn btn-default" id="answer4"></div> </li> <li> <div class="answbtn text-left btn btn-default" id="answer5"></div> </li> </ul> </div> <div class="conteiner help-box" style="display: none;"> <div class="row"> <div class="col-12 text-left"> <ul class="list-inline"> <li><button class="helpbtn btn btn-default">ПОЯСНЕНИЕ</button></li> <li><button class="penaltybtn btn btn-default">ШТРАФЫ</button></li> <li><button class="nextbtn btn btn-success">Далее</button></li> </ul> </div> </div> <ul class="list-inline" id="help-text"></ul> </div> </div> </div>';
        initBtnForTickets();
      }

      function leadersFunction(leader) {
          for (let i = 0; i < leader.leaders.length; i++) {
              document.getElementById('js-leader-name' + i).innerText = leader.leaders[i].user_leader;
              $('#js-leader-name' + i).attr('title', leader.leaders[i].user_leader);
              document.getElementById('js-leader-city' + i).innerText = leader.leaders[i].city;
              $('#js-leader-city' + i).attr('title', leader.leaders[i].city);
              document.getElementById('js-leader-coins' + i).innerText = leader.leaders[i].points;
              const element = document.getElementsByClassName('js-leader-avatar' + i);
              $(element).attr("src", leader.leaders[i].avatar);
          }
      }

      function changeDataWrongQuestions(data) {
        const wrongQuestionHTML = document.querySelector('.wrong-question');
        const btnListHTML = document.querySelector('.buttonbox');
        const templateElement = document.getElementById('templateQuestionList');
        const templateButton = document.getElementById('countButton');
        const templateContainer = 'content' in templateElement ? templateElement.content : templateElement;
        const btnContainer = 'content' in templateButton ? templateButton.content : templateButton;
        const countButton = Math.ceil(data.questions_count / 5);

        function changeWrongQuestions(container, data) {
          wrongQuestionHTML.innerHTML = '';

          for (let i = 0; i < data.questions.length; i++) {
            if (!data.questions[i]) {
              return;
            }

            const newElement = container.querySelector('.js-question-block').cloneNode(true);
            newElement.dataset.id = i;
            newElement.querySelector('.js-question-text').textContent = data.questions[i].question__question;
            newElement.querySelector('.js-question-img').src = '/media/' + data.questions[i].question__picture;
            wrongQuestionHTML.appendChild(newElement);
          }

          $('.js-question-block').click(function() {
            const id = this.dataset.id;
            
            if (isNaN(id)) {
              return;
            }

            changeWrongQuestion(data.questions[id]);
          });

          function changeWrongQuestion(data) {
            initWrongQuestionReload = false;
            wrongQuestionHTML.innerHTML = '';
            btnListHTML.innerHTML = '';
            const newElementQuestion = singleQuestionTemplate(data);

            wrongQuestionHTML.appendChild(newElementQuestion);

            let timer;

            $('.js-wrong-question-refresh').click(function() {
              $(newElementQuestion.querySelector('.help-box')).hide();
              for (let i = 1; i < 6; i++) {
                const items = newElementQuestion.querySelector('#answer' + i);
                $(items).removeClass('disabled');
                $(items).removeClass('btn-danger');
              }
              initWrongQuestionReload = true;

              $('.answbtn').click(function() {
                const user_answ = this.textContent;
                const btn = this;
                if (!initWrongQuestionReload) {
                  return;
                }

                $.ajax({
                  type: "GET",
                  url: "/check_answer/",
                  data: {
                    'number_of_ticket': data.question__number_of_ticket,
                    'number_of_question': data.question__number_of_question,
                    'category': data.question__category,
                    'answer_by_user': user_answ,
                    'wrong': true,
                    'theme': false,
                  },
                  success: function (data) {
                    if (data.true_answer) {
                      $(getElementByClassAndtextContent('answbtn', user_answ)).addClass('btn-danger');
                      return;
                    }
                    $(newElementQuestion.querySelector('.help-box')).show();
                    const helpText = newElementQuestion.querySelector('#help-text');
                    helpText.textContent = 'Правильно';
                    $(helpText).addClass('text-success');
                    $(btn).addClass('btn-success');
                    timer = setTimeout(function() {
                      changeWrongQuestion(data.next_question);
                    }, 1500);
                  }
                });
              });
            });

            $('.nextbtn').click(function() {
              clearTimeout(timer);
              console.log(data);
              $.ajax({
                type: "GET",

                url: "get_wrong_questions/",

                data: {
                    'category': category,
                    'counter': 0,
                    'next': true,
                    'value_next': data.question_id
                },

                cache: false,

                success: function (data) {
                  changeWrongQuestion(data.question);
                }
              });
            });
          }
        }

        changeWrongQuestions(templateContainer, data);

        if (initBool) {
          reloadBtn(0);
          initBool = false;
        }

        function reloadBtn(start = 0, end = 0) {
          let count = countButton > start + 9 ? start + 9 : countButton;

          if (end !== 0) {
            count = end;
          }

          document.querySelector('.buttonbox').innerHTML = '';

          if (start !== 0) {
            const newElementBtn = btnContainer.querySelector('.custombtn').cloneNode(true);
            newElementBtn.textContent = '...';
            newElementBtn.dataset.id = 'getLess';
            btnListHTML.appendChild(newElementBtn);
          }

          for (let k = start; k < count; k++) {
            const newElementBtn = btnContainer.querySelector('.custombtn').cloneNode(true);
            newElementBtn.textContent = k + 1;
            newElementBtn.dataset.id = k + 1;

            if (k === start + 8) {
              newElementBtn.textContent = '...';
              newElementBtn.dataset.id = 'getMore';
            }

            btnListHTML.appendChild(newElementBtn);
          }

          $('.custombtn').click(event => {
            if (!isNaN(event.target.dataset.id)) {
              getWrongQuestions(category, event.target.dataset.id - 1);
              return;
            }

            if (event.target.dataset.id === 'getMore') {
              reloadBtn(count - 1);
            }

            if (event.target.dataset.id === 'getLess') {
              let min = count;

              [...document.getElementsByClassName('custombtn')].map(elem => {
                if (min > parseInt(elem.dataset.id) && !isNaN(elem.dataset.id)) {
                  min = elem.dataset.id;
                }
              });
              reloadBtn(min - 9,min);
            }
          });
        }
      }

      function loadWrongQuestions(data) {
        if (initBool) {
          document.querySelector(".blockmain").innerHTML = '';
          document.querySelector(".blockmain").innerHTML = '<div class="col-12"> <div class="dropdown"> <button class="btn btn-default dropdown-toggle text-right" type="button" id="drop_for_ticket_info" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%; border: 1px solid lightgrey;"> </button> <div class="dropdown-menu text-center" aria-labelledby="drop_for_ticket_info" style="width: 100%;"> Ваши неправильные ответы </div> </div> <br><h2 class="text-danger"><i class="js-wrong-title">Ваши ошибки</i></h2><div class="row boxing top5 wrong-question"> </div> </div> <div class="buttonbox"> </div>';
        } else {
          document.querySelector(".wrong-question").innerHTML = '';
        }

        changeDataWrongQuestions(data);
      }

      $(document).ready(function() {
        loadTickets();

        $.ajax({
          type: "GET",
          url: "/get_leaders/",
          cache: false,
          success: function(data){
            leadersFunction(data);
          }
        });
      });

  </script>

  {% if user.is_authenticated %}

  <script>

    function renderMarathon() {
      const html = document.querySelector('.blockmain');
      html.innerHTML = '';
      const templateElement = document.getElementById('templateMarathon');
      const templateContainer = 'content' in templateElement ? templateElement.content : templateElement;
      html.append(templateContainer.querySelector('.marathon').cloneNode(true));
    }

    function checkResult () {
        $.ajax({

            type: "GET",

            url: "check_results/",

            data: {
                'category': category
            },

            cache: false,

            success: function (data) {
                $(".progress").show();
                for (var i = 0; i <= 39; i++) {
                    if (data.results[i]) {
                        document.getElementById('success' + (i + 1)).style.width = (data.results[i].true * 5) + '%';
                        document.getElementById('danger' + (i + 1)).style.width = (data.results[i].false * 5) + '%';
                        document.getElementById('secondary' + (i + 1)).style.width = (100 - (data.results[i].true + data.results[i].false) * 5) + '%';
                    }
                }
            }
        });
    }

    $(document).ready(function() {
      checkResult();
    });

    $("#cat1").click(function () {
      $(this).addClass("active");
      $('#cat2').removeClass("active");

      if (initTickets) {
        if (number_of_ticket === 0) {
          category = 0;
          checkResult();
        }
      }

      if (initWrong) {
        category = 0;
        getWrongQuestions(category, counterWrongQuestion);
      }
    });

    $("#cat2").click(function () {

      $(this).addClass("active");
      $('#cat1').removeClass("active");

      if (initTickets) {
        if (number_of_ticket === 0) {
          category = 1;
          checkResult();
        }
      }

      if (initWrong) {
        category = 1;
        getWrongQuestions(category, counterWrongQuestion);
      }
    });

    $('#block2').click(() => {
      clearInits();
      initTickets = true;
      if (!initTickets) {
        return;
      }

      loadTickets();
      checkResult();
    })

    $('#block6').click(function () {
      clearInits();
      initWrong = true;

      getWrongQuestions(category, counterWrongQuestion);
    });

    $('#block5').click(function () {
      clearInits();
      initMarathon = true;

      renderMarathon();
    })


</script>

  {% else %}

    <script>

    $('#block5').click(function () {
      $('#block3').popover('hide');
      $('#block6').popover('hide');
      $(this).popover('toggle');
    });

    $('#block6').click(function () {
      $('#block3').popover('hide');
      $('#block5').popover('hide');
      $(this).popover('toggle');
    })


    $("#cat1").click(function () {
      $(this).addClass("active");
      $('#cat2').removeClass("active");
      
      if (number_of_ticket === 0) {
        category = 0;
      }
    });

    $("#cat2").click(function () {
      $(this).addClass("active");
      $('#cat1').removeClass("active");
        
      if (number_of_ticket === 0) {
        category = 1;
      }
    });

    $('#block2').click(() => {
      clearInits();
      initTickets = true;

      loadTickets();
    });

    </script>

  {% endif %}

  <script>

  let theme = 1;

  function renderQuestion(data) {
    const mainblock = document.querySelector('.themebtn1');

    mainblock.innerHTML = data;
    $('.js-btnquest').click(function() {
      const id = this.dataset.id;

      if (id === 'after') {
        const min = document.getElementsByClassName('js-btnquest')[1].dataset.id;

        $.ajax({
          type: "GET",

          url: "load_questions_by_theme/",

          data: {
              'category': category,
              'theme': theme,
              'counter': min
          },

          cache: false,

          success: function (data) {
            renderQuestion(data);
          }
        });
        return;
      }

      if (id === 'next') {
        const btns = document.getElementsByClassName('js-btnquest');
        const max = btns[btns.length - 2].dataset.id;

        $.ajax({
          type: "GET",

          url: "load_questions_by_theme/",

          data: {
              'category': category,
              'theme': theme,
              'counter': max
          },

          cache: false,

          success: function (data) {
            renderQuestion(data);
          }
        });
        return;
      }

      $.ajax({
          type: "GET",

          url: "load_questions_by_theme/",

          data: {
              'category': category,
              'theme': theme,
              'counter': id
          },

          cache: false,

          success: function (data) {
            renderQuestion(data);
          }
        });
    });

    $('.answbtn').click(function() {
      const answbtn = this;
        const user_answ = this.textContent || this.innerText;
        const img = document.querySelector('.js-img-question');
        const number_of_ticket = img.dataset.ticket;
        const number_of_question = img.dataset.question;
        const theme = img.dataset.theme;

        $.ajax({

          type: "GET",

          url: "check_answer/",

          data: {
              'number_of_ticket': number_of_ticket,
              'number_of_question': number_of_question,
              'category': category,
              'answer_by_user': user_answ,
              'theme': false,
              'wrong': false
          },
          dataType: 'json',

          cache: false,

          success: function (data) {
            $('.help-box').show();
              $.ajax({

                type: "GET",

                url: "check_points/",

                cache: false,

                success: function (data) {
                    document.getElementById('bonus').textContent = data.points;
                }
            });

              if (user_answ === data.true_answer) {
                  $(answbtn).addClass("btn-success");
              } else {
                  $(answbtn).addClass("btn-danger");
                  var true_answbtn = getElementByClassAndtextContent("answbtn", data.true_answer);
                  $(true_answbtn).addClass("btn-success");
              }
              $('.answbtn').addClass("disabled");

              $('.nextbtn').click(function() {
                const id = document.querySelector('.js-img-question').dataset.next;
                $.ajax({
                  type: "GET",

                  url: "load_questions_by_theme/",

                  data: {
                      'category': category,
                      'theme': theme,
                      'counter': parseInt(id, 10) + 1
                  },

                  cache: false,

                  success: function (data) {
                    renderQuestion(data);
                  }
                });
              });
            }
        });
    });
  }
    function changeDataByTheme() {
      const mainblock = document.querySelector('.blockmain');
      const firstThemeTemplate = document.getElementById('blockTheme');
      const contentThemeBtnTemplate = document.getElementById('themeBtnTemplate');
      const firstThemeTemplateContainer = 'content' in firstThemeTemplate ? firstThemeTemplate.content : firstThemeTemplate;
      const contentThemeBtnContainer = 'content' in contentThemeBtnTemplate ? contentThemeBtnTemplate.content : contentThemeBtnTemplate;
      const firstBlockBtnTheme = firstThemeTemplateContainer.querySelector('.themese').cloneNode(true);
      const content = firstBlockBtnTheme.querySelector('.themebtn1');

      for (let i = 0; i < 4; i++) {
        const contentThemeBtn = contentThemeBtnContainer.querySelector('.themebtncontent').cloneNode(true);
        $(contentThemeBtn).attr('value', i);
        contentThemeBtn.querySelector('.theme-text').textContent = i + 'тема';
        content.appendChild(contentThemeBtn);
      }
      mainblock.innerHTML = '';
      mainblock.appendChild(firstBlockBtnTheme);

      $('.themebtncontent').click(function() {
        theme = parseInt($(this).attr('value'), 10) + 1;

        $.ajax({
          type: "GET",

          url: "load_questions_by_theme/",

          data: {
              'category': category,
              'theme': theme,
              'counter': 1
          },

          cache: false,

          success: function (data) {
            renderQuestion(data);
          }
        });
      });
    }

    $('#block4').click(function () {
      clearInits();
      intitThemes = true;

      if (!intitThemes) {
        return;
      }

      changeDataByTheme();
    });

    $("#navonlineitem1").addClass("active");

    $(".navonlineitem").click(function(){
        var id = $(this).attr("id");
        var e = document.getElementById(id);
        $(".navonlineitem").removeClass("active");
        $(e).addClass("active");
    });

    $(".btn_for_online").click(function(){
        var id = $(this).attr("id");
        var e = document.getElementById(id);
        $(".btn_for_online").removeClass("btn_for_online_active");
        $(e).addClass("btn_for_online_active");
    });

    $('#block3').click(function () {
      $('#block5').popover('hide');
      $('#block6').popover('hide');
      $(this).popover('toggle');
    });
  </script>
{% endblock %}
