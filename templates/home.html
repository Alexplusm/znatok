{% extends "base.html" %}
{% load static %}

{% block panelbody %}
<div class="panel-body">
    <div class="conteiner">
        <div class="row" >
          {% block coins %}
            <form class="form-inline col-12">
                <div class="form-group ml-auto">
                    <label for="bonus">БАЛЛЫ</label>
                    <div class="card card-body justify-content-center align-items-center" id="bonus" style="height: 35px; width: 80px">
                    </div>
                </div>

                <div class="form-group ml-auto">
                    <label for="team">КОМАНДНЫЕ</label>
                    <input type="team" class="form-control" id="team" readonly="123">
                </div>

                <div class="form-group ml-auto mr-auto">
                    <label for="coins">BEEPCOIN</label>
                    <input type="coins" class="form-control" id="coins" readonly="123">
                </div>
            </form>
            {% endblock %}
        </div>
    </div>
</div>
{% endblock %}


{% block main %}
<div id="navbartheory">
     <div class="conteiner text-center">
      <div class="row" style="margin-right: auto;">
       <div class="col-2 ml-auto text-uppercase">
        <div class="row">
         <ul class="navleft nav flex-column">
        <li class="nav-item2">
          <a class="nav-link" href="#">Теория</a>
        </li>
      <li class="nav-item2 top">
          <a class="nav-link active" href="#">Билеты</a>
        </li>
        <li class="nav-item2 top">
          <a class="nav-link" href="#">Экзамен</a>
        </li>
        <li class="nav-item2 top">
          <a class="nav-link" href="#">по темам</a>
        </li>
        <li class="nav-item2 top">
          <a class="nav-link" href="#">марафон</a>
        </li>
        <li class="nav-item2 top">
          <a class="nav-link" href="#">ошибки</a>
        </li>
      </ul>
        </div>
       </div>
       <div class="col-6 text-uppercase">
        <div class="row">
         <ul class="nav">
        <li class="nav-item">
          <a class="nav-link active" href="#" id="cat1">Категории <strong>A, B, M</strong></a>
        </li>
        <li class="nav-item ml-auto">
          <a class="nav-link" href="#" id="cat2">Категории <strong>C, D</strong></a>
        </li>
      </ul>
     </div>
     <div class="row" style="margin-left: 5px;">
     	{% block ticketmain %}
      <div class="col-12 bordering text-center blockmain">
	       <div class="row boxing top5">
		          <button class="btnticket btn btn-default ml-auto" id="btnticket1" type="button" value="1">1</button>	
		          <button class="btnticket btn btn-default ml-auto" id="btnticket2" type="button" value="2">2</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket3" type="button" value="3">3</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket4" type="button" value="4">4</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket5" type="button" value="5">5</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket6" type="button" value="6">6</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket7" type="button" value="7">7</button>
		          <button class="btnticket btn btn-default ml-auto mr-auto" id="btnticket8" type="button" value="8">8</button>
		 	</div>
		 	<div class="row boxing top5">
		          <button class="btnticket btn btn-default ml-auto" id="btnticket9" type="button" value="9">9</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket10" type="button" value="10">10</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket11" type="button" value="11">11</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket12" type="button" value="12">12</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket13" type="button" value="13">13</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket14" type="button" value="14">14</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket15" type="button" value="15">15</button>
		          <button class="btnticket btn btn-default ml-auto mr-auto" id="btnticket16" type="button" value="16">16</button>
		 	</div>
		 	<div class="row boxing top5">
		          <button class="btnticket btn btn-default ml-auto" id="btnticket17" type="button" value="17">17</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket18" type="button" value="18">18</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket19" type="button" value="19">19</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket20" type="button" value="20">20</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket21" type="button" value="21">21</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket22" type="button" value="22">22</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket23" type="button" value="23">23</button>
		          <button class="btnticket btn btn-default ml-auto mr-auto" id="btnticket24" type="button" value="24">24</button>
		 	</div>
		 	<div class="row boxing top5">
		          <button class="btnticket btn btn-default ml-auto" id="btnticket25" type="button" value="25">25</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket26" type="button" value="26">26</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket27" type="button" value="27">27</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket28" type="button" value="28">28</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket29" type="button" value="29">29</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket30" type="button" value="30">30</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket31" type="button" value="31">31</button>
		          <button class="btnticket btn btn-default ml-auto mr-auto" id="btnticket32" type="button" value="32">32</button>
		 	</div>
		 	<div class="row boxing top5">
		          <button class="btnticket btn btn-default ml-auto" id="btnticket33" type="button" value="33">33</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket34" type="button" value="34">34</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket35" type="button" value="35">35</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket36" type="button" value="36">36</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket37" type="button" value="37">37</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket38" type="button" value="38">38</button>
		          <button class="btnticket btn btn-default ml-auto" id="btnticket39" type="button" value="39">39</button>
		          <button class="btnticket btn btn-default ml-auto mr-auto" id="btnticket40" type="button" value="40">40</button>
		 	</div>
		 	<div class="row boxing btnquest-box" style="display:none">
		          <button class="btnquest btn btn-default ml-auto" id="btnquest1" value="1">1</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest2" type="button" value="2">2</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest3" type="button" value="3">3</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest4" type="button" value="4">4</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest5" type="button" value="5">5</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest6" value="6">6</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest7" type="button" value="7">7</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest8" type="button" value="8">8</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest9" type="button" value="9">9</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest10" type="button" value="10">10</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest11" type="button" value="11">11</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest12" type="button" value="12">12</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest13" type="button" value="13">13</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest14" type="button" value="14">14</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest15" type="button" value="15">15</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest16" type="button" value="16">16</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest17" type="button" value="17">17</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest18" type="button" value="18">18</button>
		          <button class="btnquest btn btn-default ml-auto" id="btnquest19" type="button" value="19">19</button>
		          <button class="btnquest btn btn-default ml-auto mr-auto" id="btnquest20" type="button" value="20">20</button>

		          <button class="btnquest btn btn-default mr-auto" id="btnquestnext" type="button" value="next">...</button>
	      </div>
			

			 <div id="result" class="result row boxing top5" style="display: none">
                 <div class="conteiner" style="width: 100%;">
 		<div class="row boxing">
 			<div class="col-xs-12 col-md-12 col-lg-6">
 				<div class="row">
					<img src="" class="imgquestion" />
				</div>
			</div>
 			<div class="col-xs-12 col-md-12 col-lg-6 text-left objquestion">
	 				<p id="quest"></p>
	 			</div>

 			</div>
 			<div class="">
				<ul class="list-unstyled">
					<li>
						<button class="answbtn text-left btn btn-default" id="answer1"></button>
					</li>
					<li>
						<button class="answbtn text-left btn btn-default" id="answer2"></button>
					</li>
					<li>
						<button class="answbtn text-left btn btn-default" id="answer3"></button>
					</li>
                    <li>
						<button class="answbtn text-left btn btn-default" id="answer4"></button>
					</li>
					<li>
						<button class="answbtn text-left btn btn-default" id="answer5"></button>
					</li>
				</ul>
			</div>



			<div class="conteiner help-box" style="display: none">
				    <div class="row">
				        <ul class="list-inline" id="help-text"></ul>
				    </div>
				    <div class="row">
				        <div class="col-12 text-left">
				            <ul class="list-inline">
				                <li><button class="helpbtn btn btn-default">ПОЯСНЕНИЕ</button></li>
				                <li><button class="penaltybtn btn btn-default">ШТРАФЫ</button></li>
				          		<li><button class="nextbtn btn btn-success">Далее</button></li>
				            </ul>
				        </div>
				    </div>
            </div>
                 </div>
	      </div>
      </div>
	      {% endblock %}
     </div>
       </div>
       <div class="col-2 mr-auto">
        <div class="row">
         <div class="col-12 w2">
          <p class="text-uppercase" style="color: blue; font-size: 20px;">Лидеры недели</p>
          <div class="row padb" style="border-top: 1px solid lightgrey;">
           <div class="col-4">
            
           </div>
           <div class="col-4">
            <div class="row">
             <div class="col-12 text3">
              <p style="font-size: 17px;">Имя</p>
              <small>Город</small>
             </div>
            </div>
           </div>
           <div class="col-4">
            <div class="row">
             <img src="/static/img/gold.png" id="gold" />
            </div>
           </div>
           <div class="col-12 ml-auto" style="margin-top: 5px;">
            <div class="row">
             <div class="col-4 ml-auto text-right">
              БАЛЛЫ
             </div>
             <div class="col-4" style="border: 1px solid black;">
              12345
             </div>
            </div>
           </div>
          </div>

          <div class="row padb">
           <div class="col-4">
            
           </div>
           <div class="col-4">
            <div class="row">
             <div class="col-12 text3">
              <p style="font-size: 17px;">Имя</p>
              <small>Город</small>
             </div>
            </div>
           </div>
           <div class="col-4">
            <div class="row">
             <img src="/static/img/silver.png" id="gold"/>
            </div>
           </div>
           <div class="col-12 ml-auto" style="margin-top: 5px;">

            <div class="row">
             <div class="col-4 ml-auto text-right">
              БАЛЛЫ
             </div>
             <div class="col-4" style="border: 1px solid black;">
              12345
             </div>
            </div>
           </div>
          </div>

          <div class="row padb">
           <div class="col-4">
            
           </div>
           <div class="col-4">
            <div class="row">
             <div class="col-12 text3">
              <p style="font-size: 17px;">Имя</p>
              <small>Город</small>
             </div>
            </div>
           </div>
           <div class="col-4">
            <div class="row">
             <img src="/static/img/bronze.png" id="gold"/>
            </div>
           </div>
           <div class="col-12 ml-auto" style="margin-top: 5px;">

            <div class="row">
             <div class="col-4 ml-auto text-right">
              БАЛЛЫ
 </div>
             <div class="col-4" style="border: 1px solid black;">
              12345
             </div>
            </div>
           </div>
          </div>
      </div>
        </div>
       </div>
   </div>
     </div>
 </div>
{% endblock %}

{% block online %}
<div id="online" class="background2">
	<div class="conteiner opacity1">
		<div class="row"  style="margin-right: 0px; padding-top: 40px;">
			<div class="col-md-8 col-md-offset-2">
				<div class="row">
					<div class="col-md-12">
								<div class="text-center text-uppercase ">
									<p style="color: blue; font-size: 20px;"><em><strong>Примите участие в ON-LINE состязаниях <br>с другими пользователями сайта</strong></em></p>
								</div>
					</div>
						<nav class="navbar navbar-inner">
				            <ul class="nav">
				              <li class="nav-item mr-auto"><a class="nav-link text-uppercase text-center" href="/">Знания ПДД</a></li>
				              <li class="nav-item mr-auto ml-auto"><a class="nav-link text-uppercase text-center" href="#">дорожные знаки</a></li>
				              <li class="nav-item mr-auto"><a class="nav-link text-uppercase text-center" href="#">штрафы</a></li>
				            </ul>
				          </nav>

				<div class="body">
							<div class="conteiner-fluid">
								<div class="row">
									<div class="col-md-12">
										<select class="form-control form-control-sm">
											
										</select>
									</div>
									<div class="col-md-12 col-md-offset-2">
										<div class="col-md-1">
											<button class="btn btn-default border">
												0	
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default">
												50
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default">
												100
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default">
												250	
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default">
												500	
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default">
												1000	
											</button>
										</div>
										<div class="col-md-1">
											<button class="btn btn-default border">
												СТАРТ	
											</button>
										</div>
									</div>
									
									<div class="col-12">
										<div class="col-md-3 box">
											<table class="table">
												<thead>
													<tr colspan="2">
														<p class="text-center text-uppercase">Статистика</p>
													</tr>
												</thead>
													<tbody>
														<tr>
															<td>
																<p>Выиграно</p><p>% побед</p>
															</td>
															<td>
																<p class="text-right">11/15</p><p class="text-right">73</p>
															</td>
														</tr>
														<tr>
															<td>
																<p>В рейтинге</p>
															</td>
															<td>
																<p class="text-right">1000+</p>
															</td>
														</tr>
													</tbody>
											</table>
										</div>
										
										<div class="col-md-5 main">
											<p>asda</p>
										</div>

										<div class="col-md-3 box1 pull-right">
											<table class="table">
												<thead>
													<tr colspan="2">
														<p class="text-center text-uppercase">Статистика</p>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>
															<p>Выиграно</p><p>% побед</p>
														</td>
														<td>
															<p class="text-right">-</p><p class="text-right">-</p>
														</td>
													</tr>
													<tr>
														<td>
															<p>В рейтинге</p>
														</td>
														<td>
															<p class="text-right">-</p>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>

									<div class="col-md-12">
										<div class="col-md-3 box2">
											<p class="text-center text-uppercase">Равный соперник</p>
										</div>
									</div>
								</div>
							</div>
				</div>
				<br>
				<br>
				<div class="text-uppercase ml-auto mr-auto">
					<br>
					<p style="color: blue; font-size: 20px; padding-bottom: 20px;"><strong><em>Присоединяйтесь к командной гонке за баллами</em></strong></p>
				</div>
				<br>
			</div>
		</div>
	</div>
</div>

<div id="panellamb">
		<div class="panel panel-default">
			<div class="conteiner-fluid">
				<div class="row1 row">
					<div class="col-8 ml-auto mr-auto">
						<select class="form-control form-control-sm">
							<option>select</option>
						</select>
						<div class="row">
						<div class="col-3">
						<img src="{% static 'img/greenlamb.png' %}" class=" lamb" id="lamb1" />
					</div>
					<div class="col-3">
						<img src="{% static 'img/yellowlamb.png' %}" class=" lamb" id="lamb2" />
					</div>
					<div class="col-3">
						<img src="{% static 'img/redlamb.png' %}" class="lamb" id="lamb3" />
					</div>
					<div class="col-3 text-center">
						<a class="btn btn-secondary text-uppercase confirm">Выбрать команду</a>
					</div>
				</div>
					</div>
				</div>
			</div>
		</div>
</div>
{% endblock %}
{% block javascript%}

    <script type="text/javascript" src="{% static '/js/jquery-3.2.1.min.js' %}"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

<script>

var category = 1;
var number_of_ticket = 1;
var number_of_question = 1;
var res = [];



$(document).ready(function() {
    $("#modalbtn").click(function () {
        $("#modalLogin").modal();
    });
});

$(document).ready(function() {
    $.ajax({

        type: "GET",

        url: "check_points/",

        cache: false,

        success: function (data) {
            document.getElementById('bonus').innerHTML = data.points;
        }
    });
});

$("#cat1").click(function () {
    category = 1;
    $(this).addClass("active");
    $('#cat2').removeClass("active");
});

$("#cat2").click(function () {
    category = 2;
    $(this).addClass("active");
    $('#cat1').removeClass("active");
});

function changeData(data) {

    $(".answbtn").removeClass("btn-success btn-danger");
    document.getElementById('quest').innerHTML = data.questions[0].question;
    $('.imgquestion').attr("src", "/media/" + data.questions[0].picture);
    document.getElementById('help-text').innerHTML = data.questions[0].comment_for_question;
    document.getElementById('answer1').innerHTML = data.answers[0];
    document.getElementById('answer2').innerHTML = data.answers[1];
    if (data.answers[2]) {
        document.getElementById('answer3').innerHTML = data.answers[2];
        $('#answer3').show();
    }
    else $('#answer3').hide();
    if (data.answers[3]) {
        document.getElementById('answer4').innerHTML = data.answers[3];
        $('#answer4').show();
    }
    else $('#answer4').hide();
    if (data.answers[4]) {
        document.getElementById('answer5').innerHTML = data.answers[4];
        $('#answer5').show();
    }
    else $('#answer5').hide();


    if (res[number_of_question - 1].user_answer) {
        var t_answ = getElementByClassAndInnerHtml("answbtn", res[number_of_question - 1].true_answer);
        $(t_answ).addClass('btn-success');
        if (res[number_of_question - 1].true_answer !== res[number_of_question -1].user_answer) {
            var u_answ = getElementByClassAndInnerHtml("answbtn", res[number_of_question - 1].user_answer);
            $(u_answ).addClass('btn-danger');
        }
        $('.answbtn').addClass('disabled');
        $('.help-box').show();
    } else {
        $('.answbtn').removeClass('disabled');
        $('.help-box').hide();
    }
}

function getElementByClassAndInnerHtml(className, text) {
    var elements = document.getElementsByClassName(className);
    for (var i = 0; i < elements.length; i++) {
        if (elements[i].innerHTML === text)
            return elements[i];
    }
}

$('.btnticket').click(function() {
    number_of_ticket = $(this).attr("value");
    number_of_question = 1;
    $.ajax({

        type: "GET",

        url: "load_ticket/",

        data: {'number_of_ticket': number_of_ticket},

        cache: false,

        success: function (data) {
            console.log(data);
            $('.btnticket').hide();
            $('.result').show();
            $('.btnquest-box').show();

            res = data.results;

            changeData(data);

            for (var i = 0; i <= 7; i++) {
                var btnquest = document.getElementById("btnquest" + (i + 1));
                $(btnquest).removeClass('btn-danger btn-success');
                if (res[i].user_answer) {
                    if (res[i].user_answer === res[i].true_answer) {
                        $(btnquest).addClass('btn-success');
                    } else $(btnquest).addClass('btn-danger');
                }
            }
        }
    });
});

// загрузка вопроса 
$(".btnquest").click(function () {
    number_of_question = $(this).attr("value");
    $.ajax({

        type: "GET",

        url: "load_question/",

        data: {
            'number_of_ticket': number_of_ticket,
            'number_of_question': number_of_question
        },

        cache: false,

        success: function (data) {
            console.log(data);
            changeData(data);
        }
    });
});

$(".nextbtn").click(function () {
    number_of_question++;
    $.ajax({

        type: "GET",

        url: "load_question/",

        data: {
            'number_of_ticket': number_of_ticket,
            'number_of_question': number_of_question
        },

        cache: false,

        success: function (data) {
            console.log(data);
            changeData(data);
        }
    });
});

$(".answbtn").click(function () {
    var answbtn_id = $(this).attr("id");
    var answbtn = document.getElementById(answbtn_id);
    var user_answ = answbtn.textContent || answbtn.innerText;
    var questbtn_id = "btnquest" + number_of_question;
    var questbtn = document.getElementById(questbtn_id);

    $.ajax({

        type: "GET",

        url: "check_answer/",

        data: {
            'number_of_ticket': number_of_ticket,
            'number_of_question': number_of_question,
            'answer_by_user': user_answ
        },
        dataType: 'json',

        cache: false,

        success: function (data) {
            console.log(data);
            $('.help-box').show();

            $.ajax({

                type: "GET",

                url: "check_points/",

                cache: false,

                success: function (data) {
                    document.getElementById('bonus').innerHTML = data.points;
                }
            });

            if (user_answ === data.true_answer) {
                $(answbtn).addClass("btn-success");
                $(questbtn).addClass("btn-success");
            } else {
                $(answbtn).addClass("btn-danger");
                var true_answbtn = getElementByClassAndInnerHtml("answbtn", data.true_answer);
                $(true_answbtn).addClass("btn-success");
                $(questbtn).addClass("btn-danger");
            }
            $('.answbtn').addClass("disabled");
            res[number_of_question - 1].user_answer = user_answ;
            res[number_of_question - 1].true_answer = data.true_answer;

        }
    });
});

</script>

{% endblock %}
